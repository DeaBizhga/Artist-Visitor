<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist</title>
    <link rel="stylesheet" type="text/css" href="../css/artistPanel.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js"></script>
</head>
<body>

    <div id="myModal" class="artistMenu">
        <div class="menu">
            <h3 id="home">Home</h3>
            <h3 id="items">Items</h3>
            <h3 id="auction">Auction</h3>
        </div>
    </div>

    <div style="height: 100px;">
        <div style="position:relative;width:100%;height:69px;background-color:#FCEBD5;box-shadow: 0px 2px 2px 0px #00000040;" >
            <div class="logoCont">
                <div class="imgDesign">
                </div>
                <img class="theLogo"  src="../images/logo.png"  >
            </div>
            <h2 id="artNamee" style="float: left;margin-top:29px;" class="artName">Artist Name</h2>
            <button id="myBtn"><img src="../images/Vector.png" height="24px" width="32px" ></button>
        </div>
    </div>

    <div class="artPanel">

    <div class="income">
        <div class="sold">
            <h6>Total Items Sold</h6>
            <h3 id="totalSold">12/35</h3>
        </div>
        <div class="totalIncome">
            <h6>Total Income</h6>
            <h3 id="totalincome">$1700</h3>
        </div>
        <div class="currentBid">
            <h6 class="bidHeader">Live Auctioning Item</h6>
            <h3 class="bidHeader">$1200</h3>
            <h6 class="bidHeader">current bid</h6>
        </div>
    </div>


    <div class="graph">
        <h4 class="graphHeader">Display my income for last</h4>
        <div class="days">
            <div id="st" class="fDay">
                7 Days
            </div>
            <div id="nd" class="ndDay">
                14 Days
            </div>
            <div id="rd" class="rdDay">
                30 Days
            </div>
        </div>

        <div class="chartContainer">
            <canvas style="margin:20px;width:calc(100% - 40px)" id="myChart"  height="200"></canvas>
        </div>
    </div>

    </div>

    <script>
        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const artist = getQueryParameter('artist');
        let solded=0;
        let numbSold=0;
        const totalSold=document.getElementById('totalSold');
        const totalIncome=document.getElementById('totalincome');

        const artItem=items.filter((item)=>item.artist==artist);
        artItem.map((item)=>{
            if(item.priceSold!=null){
            solded+=item.priceSold;
            numbSold++;
            }
        })

        totalSold.innerHTML=`${numbSold}/${artItem.length}`;
        totalIncome.innerHTML=`$${solded}`;
        

        const home=document.getElementById('home');
        const itemss=document.getElementById('items');
        const auction=document.getElementById('auction');


        home.addEventListener('click',function (){
            window.location.href = `index.html`;
        })
        itemss.addEventListener('click',function (){
            window.location.href = `artistCrud.html?artist=${encodeURIComponent(artist)}`;
        })
        


        let isTrue=false;


        function hide() {
            document.getElementById('myModal').classList.remove('artistMenu');
            document.getElementById('myModal').classList.remove('showMenu');
            document.getElementById('myModal').classList.add('hideMenu');
        }
        
        function show() {
            document.getElementById('myModal').classList.remove('artistMenu');
            document.getElementById('myModal').classList.remove('hideMenu');
            document.getElementById('myModal').classList.add('showMenu');
        }

        const myBtn=document.getElementById('myBtn');

        myBtn.addEventListener('click',function(){
            if(isTrue){
                hide();
                isTrue=false;
            }else{
                show();
                isTrue=true;
            }
        });



        const datat=[];

        const fDay=document.getElementById("st");
        const ndDay=document.getElementById("nd");
        const rdDay=document.getElementById("rd");
        const artname=document.getElementById("artNamee");
        artname.innerHTML=artist;


        function formatDate(date) {
            if(date!=undefined && date!=null){
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0'); 
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
            }else{
                return false;
            }
        }

        const filteredItems=items.filter((item)=>item.artist==artist)

        
        function generateDayLabels(numDays) {
            const labels = [];
            datat.splice(0, datat.length)
            let j=1;
            for (let i = numDays - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(j);
                j++;
                let val=0;
                const itemByDate=filteredItems.filter((item)=>formatDate(new Date(item.dateSold))==formatDate(date));
                if(itemByDate.length==0 || itemByDate==null){
                    datat.push(0);
                }else{
                    itemByDate.map((item)=>{
                        val+=item.priceSold;
                    })
                    datat.push(val);
                }
        }
            return labels;
        }


        const data = {
            labels: [],
            datasets: [{
                label: 'Horizontal Bar Dataset',
                data: datat,
                backgroundColor: '#A16A5E', 
                borderColor: '#A16A5E',
                borderWidth: 1 
            }]
        };


        
        const options = {
            onClick: function(event){
                console.log(event);
                var element = chart.getElementAtEvent(event);
                        for(var i=0;i<backgroundColor.length;i++){
                    backgroundColor[i] = 'rgb(124, 181, 236)';
                }
                     backgroundColor[element[0]._index] = 'red';
                  this.update()
                },
            indexAxis: 'y', 
            responsive: true,
            scales: {
                x: {
                    beginAtZero: true 
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                }
            },
        };

        fDay.addEventListener("click", function() {
            fDay.style.backgroundColor='#D44C2E';
            ndDay.style.backgroundColor='#A16A5E';
            rdDay.style.backgroundColor='#A16A5E';
            data.labels=generateDayLabels(7);
            myChart.update();
            console.log("Element clicked!");
        });
        ndDay.addEventListener("click", function() {
            fDay.style.backgroundColor='#A16A5E';
            ndDay.style.backgroundColor='#D44C2E';
            rdDay.style.backgroundColor='#A16A5E';
            data.labels=generateDayLabels(14);
            myChart.update();
            console.log("Element clicked!");
        });
        rdDay.addEventListener("click", function() {
            fDay.style.backgroundColor='#A16A5E';
            ndDay.style.backgroundColor='#A16A5E';
            rdDay.style.backgroundColor='#D44C2E';
            data.labels=generateDayLabels(30);
            myChart.update();
            console.log("Element clicked!");
        });

        function populateGraph(){
            fDay.style.backgroundColor='#A16A5E';
            ndDay.style.backgroundColor='#D44C2E';
            rdDay.style.backgroundColor='#A16A5E';
            data.labels=generateDayLabels(14);
            myChart.update();
        }


        const ctx = document.getElementById('myChart').getContext('2d');

    
        const myChart = new Chart(ctx, {
            type: 'bar', 
            data: data,
            options: options
        });

        populateGraph();

        console.log("Filtered Items:", filteredItems);
        console.log("Generated Labels:", data.labels);
        console.log("Generated Data:", data.datasets[0].data);

    </script>
    
</body>
</html>
